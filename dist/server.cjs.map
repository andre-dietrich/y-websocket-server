{"version":3,"file":"server.cjs","sources":["../src/server.js"],"sourcesContent":["#!/usr/bin/env node\n\nimport WebSocket from 'ws'\nimport http from 'http'\nimport * as number from 'lib0/number'\nimport { setupWSConnection } from './utils.js'\n\nconst wss = new WebSocket.Server({ noServer: true })\nconst host = process.env.HOST || '0.0.0.0'\nconst port = number.parseInt(process.env.PORT || '1234')\n\nconsole.warn(`host: ${host}`)\nconsole.warn(`port: ${port}`)\n\nconst server = http.createServer((_request, response) => {\n  response.writeHead(200, { 'Content-Type': 'text/plain' })\n  response.end('okay')\n})\n\nwss.on('connection', setupWSConnection)\n\nserver.on('upgrade', (request, socket, head) => {\n  console.log(`Upgrade request received: ${request.url}`)\n\n  try {\n    wss.handleUpgrade(\n      request,\n      socket,\n      head,\n      /** @param {any} ws */ (ws) => {\n        console.log('WebSocket connection established')\n        wss.emit('connection', ws, request)\n      }\n    )\n  } catch (error) {\n    console.error('WebSocket upgrade error:', error)\n    socket.destroy()\n  }\n})\n\nserver.listen(port, host, () => {\n  console.log(`running at '${host}' on port ${port}`)\n  console.log(\n    `WebSocket server started, environment: ${\n      process.env.NODE_ENV || 'development'\n    }`\n  )\n})\n\n// Add error handlers\nserver.on('error', (err) => {\n  console.error('Server error:', err)\n})\n\nwss.on('error', (err) => {\n  console.error('WebSocket server error:', err)\n})\n"],"names":["number","setupWSConnection"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,MAAM,GAAG,GAAG,IAAI,SAAS,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE;AACnD,MAAM,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI;AACjC,MAAM,IAAI,GAAGA,iBAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,MAAM;;AAEvD,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC5B,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;;AAE5B,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,QAAQ,EAAE,QAAQ,KAAK;AACzD,EAAE,QAAQ,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,cAAc,EAAE,YAAY,EAAE;AAC1D,EAAE,QAAQ,CAAC,GAAG,CAAC,MAAM;AACrB,CAAC;;AAED,GAAG,CAAC,EAAE,CAAC,YAAY,EAAEC,uBAAiB;;AAEtC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,OAAO,EAAE,MAAM,EAAE,IAAI,KAAK;AAChD,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,0BAA0B,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;;AAExD,EAAE,IAAI;AACN,IAAI,GAAG,CAAC,aAAa;AACrB,MAAM,OAAO;AACb,MAAM,MAAM;AACZ,MAAM,IAAI;AACV,6BAA6B,CAAC,EAAE,KAAK;AACrC,QAAQ,OAAO,CAAC,GAAG,CAAC,kCAAkC;AACtD,QAAQ,GAAG,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,EAAE,OAAO;AAC1C;AACA;AACA,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK;AACnD,IAAI,MAAM,CAAC,OAAO;AAClB;AACA,CAAC;;AAED,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM;AAChC,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;AACpD,EAAE,OAAO,CAAC,GAAG;AACb,IAAI,CAAC,uCAAuC;AAC5C,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI;AAC9B,KAAK;AACL;AACA,CAAC;;AAED;AACA,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,KAAK;AAC5B,EAAE,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,GAAG;AACpC,CAAC;;AAED,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,KAAK;AACzB,EAAE,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,GAAG;AAC9C,CAAC;;"}